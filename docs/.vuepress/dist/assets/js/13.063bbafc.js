(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{339:function(t,s,a){"use strict";a.r(s);var n=a(3),p=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"gzip压缩"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gzip压缩"}},[t._v("#")]),t._v(" gzip压缩")]),t._v(" "),s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("很多Vue项目，都有一个通病，随着代码越来越庞大，首页加载越来越慢，有时候出去演示，网络不好的时候，转半天，登录页面还没有出来。这主要是一些大的js文件造成的，这就是Vue的缺点吧，所有的代码都打包到一个JS文件里，网络传输太慢，有的项目都十几兆。")])]),t._v(" "),s("li",[s("p",[t._v("gzip的本质，是在build的时候打包两份代码，一份压缩的，一份未压缩的，然后nginx在接收请求时，优先选择压缩后的格式返给客户端。")])]),t._v(" "),s("li",[s("p",[t._v("使用gzip进行压缩，可以压缩js和css文件大小，提升加载速度。")])])]),t._v(" "),s("h2",{attrs:{id:"前端代码配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端代码配置"}},[t._v("#")]),t._v(" 前端代码配置")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("下载代码压缩插件，运行命令"),s("code",[t._v("npm i compression-webpack-plugin@1.1.2")])])]),t._v(" "),s("li",[s("p",[t._v("写入压缩配置，如下")])])]),t._v(" "),s("p",[s("code",[t._v("build/webpack.prod.conf.js")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("build"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("productionGzip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" CompressionWebpackPlugin "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'compression-webpack-plugin'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  webpackConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CompressionWebpackPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("filename")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[path].gz[query]'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("algorithm")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gzip'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RegExp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\\\.('")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n        config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("build"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("productionGzipExtensions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'|'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("')$'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("threshold")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10240")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("minRatio")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.8")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("code",[t._v("config/index.js")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("productionGzip")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("productionGzipExtensions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("tips: "),s("code",[t._v("config/index.js")]),t._v("文件中的"),s("code",[t._v("productionGzip")]),t._v("变量起到了快捷开关压缩功能的作用,"),s("code",[t._v("productionGzipExtensions")]),t._v("用来规定需要压缩的文件类型。")]),t._v(" "),s("h2",{attrs:{id:"nginx服务器配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx服务器配置"}},[t._v("#")]),t._v(" nginx服务器配置")]),t._v(" "),s("ol",[s("li",[t._v("修改nginx服务器配置，开启服务器的gzip功能，向"),s("code",[t._v("nginx.conf")]),t._v("文件中写入配置，如下")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("http "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n gzip  on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n gzip_min_length  1k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" # 不压缩临界值，大于1K的才压缩\n gzip_buffers     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" 16k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n gzip_http_version "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n gzip_comp_level "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n gzip_types     text"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("plain application"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("javascript application"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("javascript text"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("javascript text"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("css application"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("xml application"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("xml"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("rss"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" # #进行压缩的文件类型\n gzip_vary on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n gzip_proxied   expired no"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cache no"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("store "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" auth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n gzip_disable   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MSIE [1-6]\\."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("一些常规内容\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("tips: 以上配置书写位置在"),s("code",[t._v("server")]),t._v("之前即可。")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("重启nginx服务器，以便让上面的配置生效"),s("code",[t._v("nginx -s reload")])])]),t._v(" "),s("h2",{attrs:{id:"效果分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#效果分析"}},[t._v("#")]),t._v(" 效果分析")]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/1735744ec7df59f3.png",alt:"图片"}})]),t._v(" "),s("p",[t._v("通常"),s("code",[t._v("gzip")]),t._v("压缩可以减小文件大小"),s("code",[t._v("70%")]),t._v("以上，效果还是比较显著的，在相同网络状况下，首屏加载时间可以加快"),s("code",[t._v("40%")]),t._v("以上，大幅提升加载速度，增强用户体验。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/1735746db1170442.png",alt:"图片"}})]),t._v(" "),s("p",[t._v("如果gzip开启成功，在请求响应头中会看到gzip相关字样，并且size会相应变小。")])])}),[],!1,null,null,null);s.default=p.exports}}]);