<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>js模块化</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.0ea0f453.css" as="style"><link rel="preload" href="/assets/js/app.794e7dce.js" as="script"><link rel="preload" href="/assets/js/2.4851646e.js" as="script"><link rel="preload" href="/assets/js/21.c9e91a40.js" as="script"><link rel="prefetch" href="/assets/js/10.143669db.js"><link rel="prefetch" href="/assets/js/11.501040b0.js"><link rel="prefetch" href="/assets/js/12.f7543025.js"><link rel="prefetch" href="/assets/js/13.6a8a3e61.js"><link rel="prefetch" href="/assets/js/14.ca5f0446.js"><link rel="prefetch" href="/assets/js/15.d529e80e.js"><link rel="prefetch" href="/assets/js/16.5cc2c052.js"><link rel="prefetch" href="/assets/js/17.42e8f624.js"><link rel="prefetch" href="/assets/js/18.f7b197fd.js"><link rel="prefetch" href="/assets/js/19.4067c170.js"><link rel="prefetch" href="/assets/js/20.e86de217.js"><link rel="prefetch" href="/assets/js/22.b3a80e7e.js"><link rel="prefetch" href="/assets/js/23.7131254e.js"><link rel="prefetch" href="/assets/js/24.53cc25e6.js"><link rel="prefetch" href="/assets/js/25.feaeb4ee.js"><link rel="prefetch" href="/assets/js/26.734ecf75.js"><link rel="prefetch" href="/assets/js/3.2972c7a3.js"><link rel="prefetch" href="/assets/js/4.5c98921b.js"><link rel="prefetch" href="/assets/js/5.e7bff750.js"><link rel="prefetch" href="/assets/js/6.348aef91.js"><link rel="prefetch" href="/assets/js/7.72baa125.js"><link rel="prefetch" href="/assets/js/8.48fc0111.js"><link rel="prefetch" href="/assets/js/9.cbdd8595.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0ea0f453.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open no-sidebar have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/674948122/pdg-doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/674948122/pdg-doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <!----> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><!----> <div class="info" data-v-06225672><!----> <!----> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">js模块化<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="js模块化"><a href="#js模块化" class="header-anchor">#</a> js模块化</h1> <h2 id="一、什么是模块化"><a href="#一、什么是模块化" class="header-anchor">#</a> 一、什么是模块化</h2> <p>在js刚刚出现的时候，是为了实现一些简单的功能，但随着浏览器的不断发展，js越来越被重视起来，可以实现较为复杂的功能。这个时候开发者为了维护方便，会把不同功能的模块抽离出来写入单独的js文件，但是当项目更为复杂的时候，html可能会引入很多个js文件，而这个时候就会出现命名冲突，污染作用域等一系列问题，这个时候模块化的概念及实现方法应运而生。</p> <p>模块化开发是一种管理方式，一种生产方式，一种解决问题的方案。一个模块就是实现某个特定功能的文件，我们可以很方便的使用别人的代码，想要什么模块，就引入那个模块。但是模块开发要遵循一定的规范，后面就出现了我们所熟悉的AMD和CMD规范。</p> <h2 id="二、立即执行函数"><a href="#二、立即执行函数" class="header-anchor">#</a> 二、立即执行函数</h2> <p>在早期，使用立即执行函数实现模块化是最常见的手段，通过函数作用域解决了命名冲突、污染全局的问题，那么立即执行函数也是一种模块化的实现方式，但并非是一种解决方案。举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在这里面声明各种变量、函数都不会污染全局作用域</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
</code></pre></div><h2 id="三、amd"><a href="#三、amd" class="header-anchor">#</a> 三、AMD</h2> <p>AMD即是“异步模块定义”，它采用异步方式加载模块，模块的加载不影响后面语句的运行，所有依赖整个模块的语句，都定义在一个回调函数中，等到加载完成后，整个回调函数才会运行。</p> <p>在使用时，需引入require.js，通过require.js实现AMD规范的模块化。</p> <p>在AMD规范中，我们使用define定义模块，使用require加载模块。</p> <h3 id="_1、定义模块"><a href="#_1、定义模块" class="header-anchor">#</a> 1、定义模块</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">define</span><span class="token punctuation">(</span>id<span class="token operator">?</span><span class="token punctuation">,</span> dependencies<span class="token operator">?</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>id是定义的模块名，这个参数是可选的，如果没有定义该参数，模块名字应该默认为模块加载器请求的指定脚本的名字，如果有该参数，模块名必须是顶级的绝对的。</li> <li>dependencies是定义的模块中所依赖的模块数组，依赖模块优先级执行，并且执行结果按照数组中的排序依次以参数的形式传入factory。</li> <li>factory是模块初始化要执行的函数或对象，只被执行依次，如果是对象，则为该模块的输出值。</li></ul> <p>下面来看一个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&quot;OrderModel&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;Header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pay&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">Header<span class="token punctuation">,</span> Pay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   
    <span class="token keyword">var</span> <span class="token function-variable function">OrderModel</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>headerData <span class="token operator">=</span> Header<span class="token punctuation">.</span><span class="token function">getHeaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>payData <span class="token operator">=</span> Pay<span class="token punctuation">.</span><span class="token function">getPayData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> OrderModel<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2、加载模块"><a href="#_2、加载模块" class="header-anchor">#</a> 2、加载模块</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span>module<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>require要传入两个参数，第一个是[module]，是一个数组，就是要加载的模块，第二个callback是加载成功之后的回调函数。</p> <p>下面举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 在定义模块中已经定义过OrderModel模块了，下面只需要加载并使用它</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;OrderModel&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">OrderModel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>OrderModel<span class="token punctuation">.</span>headerData<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>OrderModel<span class="token punctuation">.</span>payData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="四、cmd"><a href="#四、cmd" class="header-anchor">#</a> 四、CMD</h2> <p>CMD即是“通用模块定义”，CMD规范是国内发展出来的，CMD和AMD都是要解决同一个问题，只不过两者在模块定义方式和模块加载时机上有所不同罢了。</p> <p>在使用时，需引入sea.js，通过sea.js实现CMD规范的模块化：</p> <ol><li>使用define()定义模块，使用require()加载模块;</li> <li>使用seajs.use加载使用模块。</li></ol> <h3 id="_1、定义模块-2"><a href="#_1、定义模块-2" class="header-anchor">#</a> 1、定义模块</h3> <p>在CMD中一个模块就是一个文件，通过define()进行定义。</p> <p>define接收factory参数，它可以使一个函数，也可以是一个对象一个字符串。</p> <ul><li>当factory是一个对象或者一个字符串时，表示该模块的接口就是这个对象或者字符串。</li> <li>当factory是一个函数时，表示是该模块的构造方法。执行该构造方法，可以得到模块向外提供的接口，factory在执行时，默认传入三个参数：require、exports、module。</li> <li>其中require用来加载其它模块。exports用来实现向外提供的模块接口。</li> <li>module是一个对象，存储着与当前模块相关联的一些属性和方法，传给factory构造方法的exports是module.exports对象的一个引用，至通过exports参数来提供对外的接口，有时无法满足所有需求，比如当模块的接口是某个类的实例时，这个时候就需要通过module.exports来实现。</li></ul> <p>下面举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 定义模块OrderModel.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">var</span> Header <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./Header'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// require用来加载其它模块    </span>
    exports<span class="token punctuation">.</span>headerData <span class="token operator">=</span> Header<span class="token punctuation">.</span><span class="token function">getHeaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对外提供headerData属性    </span>
    <span class="token comment">// exports是module.exports的一个引用</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>exports <span class="token operator">===</span> modele<span class="token punctuation">.</span>exports<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
 
    <span class="token keyword">var</span> Pay <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./Pay'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 依赖可以就近加载</span>
    exports<span class="token punctuation">.</span>payData <span class="token operator">=</span> Pay<span class="token punctuation">.</span><span class="token function">getPayData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对外提供payData属性    </span>
    exports<span class="token punctuation">.</span><span class="token function-variable function">payFun</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'payFun log something'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 对外提供payFun方法</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2、加载模块-2"><a href="#_2、加载模块-2" class="header-anchor">#</a> 2、加载模块</h3> <p>通过SeaJs的use方法我们可以加载模块</p> <p>举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 上面我们已经定义了OrderModel模块了，直接加载即可</span>
seajs<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;OrderModel.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">orderModel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> headerData <span class="token operator">=</span> orderModel<span class="token punctuation">.</span>headerData<span class="token punctuation">;</span>
    <span class="token keyword">var</span> payData <span class="token operator">=</span> orderModel<span class="token punctuation">.</span>payData<span class="token punctuation">;</span>
    orderModel<span class="token punctuation">.</span><span class="token function">payFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以直接使用，输出 payFun log something</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_3、amd与cmd的不同"><a href="#_3、amd与cmd的不同" class="header-anchor">#</a> 3、AMD与CMD的不同</h3> <ul><li>对于依赖模块，AMD是提前执行，CMD是延迟执行</li> <li>对于依赖模块，AMD是依赖前置，CMD是依赖就近</li></ul> <h2 id="五、umd"><a href="#五、umd" class="header-anchor">#</a> 五、UMD</h2> <p>UMD（Universal Module Definition）通用模块定义，为了兼容AMD、CMD和无模块化开发规范。</p> <ol><li>UMD 是AMD 和 CommonJS的糅合。 AMD 模块以浏览器第一的原则发展，异步加载模块。</li> <li>CommonJS 模块以服务器第一原则发展，选择同步加载。它的模块无需包装(unwrapped modules)。 这迫使人们又想出另一个更通用的模式 UMD（Universal Module Definition)，实现跨平台的解决方案。</li> <li>UMD 先判断是否支持 Node.js 的模块（exports）是否存在，存在则使用 Node.js 模块模式。再判断是否支持 AMD（define 是否存在），存在则使用 AMD 方式加载模块。</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * UMD-Universal Module Definition 通用模块定义
 * */</span>
 <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// 判断是否是AMD/CMD</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span>
     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// Node CommonJS规范</span>
         module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token comment">// 浏览器环境</span>
         root<span class="token punctuation">.</span>someAttr <span class="token operator">=</span> factory
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">let</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> a <span class="token operator">+</span> b
     <span class="token punctuation">}</span>
     <span class="token keyword">return</span> <span class="token punctuation">{</span>
         add<span class="token punctuation">,</span>
         <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">'UMD'</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="六、commonjs"><a href="#六、commonjs" class="header-anchor">#</a> 六、CommonJS</h2> <p>CommonJS规范主要应用于Node，每个文件就是一个模块，有自己的作用域，即在一个文件中定义的变量、函数、类都是私有的，对其他文件不可见。</p> <h3 id="_1、定义模块-3"><a href="#_1、定义模块-3" class="header-anchor">#</a> 1、定义模块</h3> <p>（上面说了每个文件就是一个模块，所以不存在定义的概念，只是为了承接上下文，更好理解罢了，文章后面不再说明。）</p> <p>CommonJs规范规定，每个模块内部有两个变量可以使用：require和module。</p> <ul><li>require用来加载某个需要的模块。</li> <li>module代表的是当前模块，是一个对象，存储着当前模块的相关联的属性和方法。exports是module上的一个属性。该属性表示当前模块对外输出的接口，其它文件加载该模块，实际上就是读取module.exports变量。（在实际开发中如果区分不了exports和module.exports的话，那就直接使用module.exports即可，那个exports就别管、别用了。）</li></ul> <p>举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// orderModel.js</span>
<span class="token keyword">var</span> Header <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./Header'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// require用来加载其它模块</span>
<span class="token keyword">var</span> Pay <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./Pay'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">var</span> <span class="token function-variable function">payFun</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'payFun log something'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 对外提供以下三个属性</span>
    <span class="token literal-property property">headerData</span><span class="token operator">:</span> Header<span class="token punctuation">.</span><span class="token function">getHeaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payData</span><span class="token operator">:</span> Pay<span class="token punctuation">.</span><span class="token function">getPayData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payFun</span><span class="token operator">:</span> payFun
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2、加载模块-3"><a href="#_2、加载模块-3" class="header-anchor">#</a> 2、加载模块</h3> <p>其实在上面的代码中，即orderModel.js中已经写出了加载模块的方法了。</p> <p>下面是加载并使用orderModel.js的例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> orderModel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./orderModel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">var</span> headerData <span class="token operator">=</span> orderModel<span class="token punctuation">.</span>headerData<span class="token punctuation">;</span>
<span class="token keyword">var</span> payData <span class="token operator">=</span> orderModel<span class="token punctuation">.</span>payData<span class="token punctuation">;</span>
orderModel<span class="token punctuation">.</span><span class="token function">payFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 payFun log something</span>
</code></pre></div><p>需要注意的是，CommonJS规范规定，模块可以多次加载，但是只会在第一次加载时运行一次，运行结果就会被缓存下来，以后再加载就直接读取缓存结果，如果想让模块再次运行，必须清除缓存。</p> <p>举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./orderModel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./orderModel'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">'hello world'</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./orderModel'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>message<span class="token punctuation">;</span>
<span class="token comment">// hello world</span>
</code></pre></div><p>清除缓存例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 删除指定模块的缓存，这里删除orderModel.js，也可以写多个进行批量删除。</span>
<span class="token keyword">delete</span> require<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./orderModel'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
<span class="token comment">// 删除所有模块的缓存，大范围攻击</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span>cache<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">delete</span> require<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="七、es-module"><a href="#七、es-module" class="header-anchor">#</a> 七、ES Module</h2> <p>在ES6没出来之前，模块加载方案主要使用CommonJS和AMD两种，前者用于服务器，后者用于浏览器。ES6在语言标准层面上实现了模块功能，而且使用起来相当简单。</p> <h3 id="_1、定义模块-4"><a href="#_1、定义模块-4" class="header-anchor">#</a> 1、定义模块</h3> <p>模块功能主要由两个命令构成：export和import，export命令用于规定模块的对外接口，import用于引入其它模块提供的功能。</p> <p>一般来说，一个模块对应的就是一个文件，该文件内部的变量外部无法获取，如果你希望外部能够读取到某个变量，就需要使用export关键字输出该变量。</p> <p>举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// user.js</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> <span class="token function-variable function">getSex</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> s <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&quot;男&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;女&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 通用写法，如果不想了解，就这样写就完事了</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">,</span>
    age<span class="token punctuation">,</span>
    getSex
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2、加载模块-4"><a href="#_2、加载模块-4" class="header-anchor">#</a> 2、加载模块</h3> <p>上面已经使用export命令定义了模块对外的接口后，其它的JS文件就可以通过import命令加载这个模块。</p> <p>举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> getSex<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user'</span><span class="token punctuation">;</span>
 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 张三</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 男</span>
</code></pre></div><p>import接受一对大括号，里面指定的是要从其它模块导入的变量名。大括号内的变量名，必须与导入模块对外接口的名称相同。</p> <p>我们经常需要对加载模块进行重命名，如下写法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>name <span class="token keyword">as</span> otherName<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user'</span><span class="token punctuation">;</span> <span class="token comment">// 使用as进行重命名</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>otherName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 张三</span>
</code></pre></div><p>我们也经常使用到对模块的整体加载，如下写法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> user <span class="token keyword">from</span> <span class="token string">'./user'</span><span class="token punctuation">;</span> <span class="token comment">// 使用 * 号指定一个对象，所有输出值都加载在这个对象上面</span>
 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 张三</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 男</span>
 
<span class="token comment">// 需要注意的是 user是静态分析的，不允许运行时改变</span>
<span class="token comment">// 下面的写法是不允许的</span>
user<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">180</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function-variable function">setOld</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3、和commonjs的区别"><a href="#_3、和commonjs的区别" class="header-anchor">#</a> 3、和CommonJS的区别</h3> <ol><li>ES Module不支持动态导入，但已提案，指日可待。</li> <li>ES Module是异步导入，因为用于浏览器，需要下载文件，如果采用同步导入对渲染有很大影响。CommonJS是同步导入，因为用于服务端，文件都在本地，同步导入即使卡主主线程影响也不大。</li> <li>ES Module导出的是值的引用，导入导出值都指向同一个内存地址，所以导入值会跟随导出值变化。而CommonJS在导出时都是值的拷贝，就算导出的值变了，导入的值也不会改变，所以想要更新值，必须重新导入一次。</li></ol> <h2 id="八、总结"><a href="#八、总结" class="header-anchor">#</a> 八、总结</h2> <ul><li><p>AMD/CMD/CommonJs 是js模块化开发的规范，对应的实现是require.js/sea.js/Node.js。</p></li> <li><p>CommonJs 主要针对服务端，AMD/CMD/ES Module主要针对浏览器端，容易混淆的是AMD/CMD。（顺便提一下，针对服务器端和针对浏览器端有什么本质的区别呢？服务器端一般采用同步加载文件，也就是说需要某个模块，服务器端便停下来，等待它加载再执行。这里如果有其他后端语言，如java。而浏览器端要保证效率，需要采用异步加载，这就需要一个预处理，提前将所需要的模块文件并行加载好。）</p></li> <li><p>AMD/CMD区别，虽然都是并行加载js文件，但还是有所区别，AMD是预加载，在并行加载js文件同时，还会解析执行该模块（因为还需要执行，所以在加载某个模块前，这个模块的依赖模块需要先加载完成）；而CMD是懒加载，虽然会一开始就并行加载js文件，但是不会执行，而是在需要的时候才执行。</p></li> <li><p>AMD/CMD的优缺点.一个的优点就是另一个的缺点， 可以对照浏览。</p></li> <li><p>AMD优点：加载快速，尤其遇到多个大文件，因为并行解析，所以同一时间可以解析多个文件。</p></li> <li><p>AMD缺点：并行加载，异步处理，加载顺序不一定，可能会造成一些困扰，甚至为程序埋下大坑。</p></li> <li><p>CMD优点：因为只有在使用的时候才会解析执行js文件，因此，每个JS文件的执行顺序在代码中是有体现的，是可控的。</p></li> <li><p>CMD缺点：执行等待时间会叠加。因为每个文件执行时是同步执行（串行执行），因此时间是所有文件解析执行时间之和，尤其在文件较多较大时，这种缺点尤为明显。（PS：重新看这篇文章，发现这里写的不是很准确。确切来说，JS是单线程，所有JS文件执行时间叠加在AMD和CMD中是一样的。但是CMD是使用时执行，没法利用空闲时间，而AMD是文件加载好就执行，往往可以利用一些空闲时间。这么来看，CMD比AMD的优点还是很明显的，毕竟AMD加载好的时候也未必就是JS引擎的空闲时间！）</p></li> <li><p>如何使用？CommonJs 的话，因为 NodeJS 就是它的实现，所以使用 node 就行，也不用引入其他包。AMD则是通过<code>&lt;script&gt;</code>标签引入require.js，CMD则是引入sea.js。</p></li> <li><p>UMD通用模块定义，为了兼容AMD、CMD和无模块化开发规范。</p></li> <li><p>CommonJS 和 ES Module 区别：CommonJS 模块输出的。是一个值的拷贝，ES6 模块输出的是值的引用。</p></li> <li><p>CommonJS 模块是运行时加载，ES6 模块是编译时输出接口。</p></li> <li><p>CommonJS 模块输出的是值的拷贝（类比于基本类型和引用类型的赋值操作）。对于基本类型，一旦输出，模块内部的变化影响不到这个值。对于引用类型，效果同引用类型的赋值操作。</p></li> <li><p>ES6 模块是动态关联模块中的值，输出的是值得引用。原始值变了，import 加载的值也会跟着变。</p></li> <li><p>ES6 模块的运行机制与 CommonJS 不一样。JS 引擎对脚本静态分析时，遇到模块加载命令 import，就会生成一个只读引用。 等到脚本真正执行时，再根据这个只读引用，到被加载的那个模块里面去取值。</p></li> <li><p>ES6 模块中，原始值变了，import 加载的值也会跟着变。因此，ES6 模块是动态引用，并且不会缓存值</p></li></ul></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/04.%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83.html"><div>
            命名规范
            <!----></div></a> <span class="date"></span></dt></dl><dl><dd>02</dd> <dt><a href="/02.git%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E5%89%8D%E5%BC%BA%E5%88%B6%E6%A0%A1%E9%AA%8Ceslint%E9%9B%86%E6%88%90.html"><div>
            git提交代码前强制校验eslint集成
            <!----></div></a> <span class="date"></span></dt></dl><dl><dd>03</dd> <dt><a href="/06.moment%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96.html"><div>
            moment打包优化
            <!----></div></a> <span class="date"></span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><canvas id="vuepress-canvas-cursor"></canvas></div></div>
    <script src="/assets/js/app.794e7dce.js" defer></script><script src="/assets/js/2.4851646e.js" defer></script><script src="/assets/js/21.c9e91a40.js" defer></script>
  </body>
</html>
